{% extends 'base.html' %}

{% block title %}パスワード変更 - KifuCloud{% endblock title %}

{% block extra_css %}
<link rel="stylesheet" href="{{ static(master, 'css/accounts.css') }}">
{% endblock extra_css %}

{% block content %}
<div class="account-page fade-in">
  <div class="account-container">
    <!-- Page Header -->
    <div class="account-header">
      <h1 class="account-title">パスワード変更</h1>
      <p class="account-subtitle">
        アカウントのセキュリティを保つため、強力なパスワードを設定してください
      </p>
    </div>

    <!-- Breadcrumb -->
    <nav class="account-breadcrumb">
      <ol class="breadcrumb-list">
        <li class="breadcrumb-item">
          <a href="{{ reverse(master, 'home') }}" class="breadcrumb-link">ホーム</a>
          <span class="breadcrumb-separator">›</span>
        </li>
        <li class="breadcrumb-item">
          <a href="{{ reverse(master, 'accounts:profile') }}" class="breadcrumb-link">アカウント情報</a>
          <span class="breadcrumb-separator">›</span>
        </li>
        <li class="breadcrumb-item">
          <span class="breadcrumb-current">パスワード変更</span>
        </li>
      </ol>
    </nav>

    <!-- Main Content Grid -->
    <div class="account-grid">
      <div class="account-main slide-up">
        <!-- Password Change Section -->
        <div class="account-section">
          <div class="section-header">
            <i data-lucide="key" class="section-icon"></i>
            <h2 class="section-title">新しいパスワードの設定</h2>
          </div>

          {% if error %}
          <div class="account-alert error">
            <i data-lucide="alert-circle" class="alert-icon"></i>
            <div>{{ error }}</div>
          </div>
          {% endif %}

          {% if message %}
          <div class="account-alert success">
            <i data-lucide="check-circle" class="alert-icon"></i>
            <div>{{ message }}</div>
          </div>
          {% endif %}

          <form method="post" class="account-form" id="changePasswordForm">
            <div class="form-group">
              <label class="form-label">{{ form.current_password.label }}</label>
              {{ form.current_password(class="form-input" + (" error" if form.current_password.errors else ""), id="currentPassword") }}
              {% if form.current_password.errors %}
              <div class="form-error">
                <i data-lucide="alert-circle" style="width: 14px; height: 14px;"></i>
                {% for error in form.current_password.errors %}
                {{ error }}
                {% endfor %}
              </div>
              {% endif %}
            </div>

            <div class="form-group">
              <label class="form-label">{{ form.new_password.label }}</label>
              {{ form.new_password(class="form-input" + (" error" if form.new_password.errors else ""), id="newPassword") }}
              {% if form.new_password.errors %}
              <div class="form-error">
                <i data-lucide="alert-circle" style="width: 14px; height: 14px;"></i>
                {% for error in form.new_password.errors %}
                {{ error }}
                {% endfor %}
              </div>
              {% endif %}
              <div class="form-help">
                8文字以上で、英数字と記号を組み合わせてください
              </div>

              <!-- Password Strength Indicator -->
              <div class="password-strength" id="passwordStrength" style="display: none;">
                <div class="strength-label">パスワードの強度:</div>
                <div class="strength-bar">
                  <div class="strength-fill" id="strengthFill"></div>
                </div>
                <div class="strength-text" id="strengthText"></div>
              </div>
            </div>

            <div class="form-group">
              <label class="form-label">{{ form.confirm_password.label }}</label>
              {{ form.confirm_password(class="form-input" + (" error" if form.confirm_password.errors else ""), id="confirmPassword") }}
              {% if form.confirm_password.errors %}
              <div class="form-error">
                <i data-lucide="alert-circle" style="width: 14px; height: 14px;"></i>
                {% for error in form.confirm_password.errors %}
                {{ error }}
                {% endfor %}
              </div>
              {% endif %}
              <div class="password-match" id="passwordMatch" style="display: none;"></div>
            </div>

            <div class="form-actions">
              <button type="submit" class="form-submit" id="submitBtn">
                <i data-lucide="key" class="btn-icon"></i>
                パスワードを変更
              </button>
              <a href="{{ reverse(master, 'accounts:profile') }}" class="action-btn secondary">
                <i data-lucide="arrow-left" class="btn-icon"></i>
                キャンセル
              </a>
            </div>
          </form>
        </div>
      </div>

      <!-- Sidebar -->
      <div class="account-sidebar slide-up">
        <h3 class="sidebar-title">ナビゲーション</h3>
        <nav class="sidebar-nav">
          <a href="{{ reverse(master, 'accounts:profile') }}" class="sidebar-link">
            <i data-lucide="user" class="sidebar-icon"></i>
            <span>アカウント情報</span>
          </a>
          <a href="{{ reverse(master, 'accounts:change_password') }}" class="sidebar-link active">
            <i data-lucide="key" class="sidebar-icon"></i>
            <span>パスワード変更</span>
          </a>
          <a href="{{ reverse(master, 'kifu:index', username=master.request.username) }}" class="sidebar-link">
            <i data-lucide="book-open" class="sidebar-icon"></i>
            <span>マイページ</span>
          </a>
          <a href="{{ reverse(master, 'home') }}" class="sidebar-link">
            <i data-lucide="home" class="sidebar-icon"></i>
            <span>ホーム</span>
          </a>
        </nav>

        <div class="help-box">
          <div class="help-title">
            <i data-lucide="shield" style="width: 14px; height: 14px;"></i>
            セキュリティのヒント
          </div>
          <div class="help-content">
            <ul class="help-list">
              <li>8文字以上で設定してください</li>
              <li>大文字と小文字を混在させましょう</li>
              <li>数字と記号を含めましょう</li>
              <li>他のサービスと同じパスワードは避けましょう</li>
              <li>定期的な変更をお勧めします</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock content %}

{% block extra_js %}
<script src="{{ static(master, 'js/accounts.js') }}"></script>
{% endblock extra_js %}