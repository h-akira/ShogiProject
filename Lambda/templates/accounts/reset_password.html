{% extends 'base.html' %}

{% block title %}パスワードリセット - KifuCloud{% endblock title %}

{% block extra_css %}
<link rel="stylesheet" href="{{ static(master, 'css/accounts.css') }}">
{% endblock extra_css %}

{% block content %}
<div class="account-page fade-in">
  <div class="account-container">
    <!-- Page Header -->
    <div class="account-header">
      <h1 class="account-title">パスワードリセット</h1>
      <p class="account-subtitle">
        確認コードを入力して、新しいパスワードを設定してください
      </p>
    </div>

    <!-- Progress Steps -->
    <div class="progress-steps">
      <div class="progress-step completed">
        <div class="step-circle">1</div>
        <div class="step-label">ユーザー名入力</div>
      </div>
      <div class="progress-step active">
        <div class="step-circle">2</div>
        <div class="step-label">確認コード入力</div>
      </div>
      <div class="progress-step">
        <div class="step-circle">3</div>
        <div class="step-label">パスワード設定</div>
      </div>
    </div>

    <!-- Breadcrumb -->
    <nav class="account-breadcrumb">
      <ol class="breadcrumb-list">
        <li class="breadcrumb-item">
          <a href="{{ reverse(master, 'home') }}" class="breadcrumb-link">ホーム</a>
          <span class="breadcrumb-separator">›</span>
        </li>
        <li class="breadcrumb-item">
          <a href="{{ reverse(master, 'accounts:login') }}" class="breadcrumb-link">ログイン</a>
          <span class="breadcrumb-separator">›</span>
        </li>
        <li class="breadcrumb-item">
          <a href="{{ reverse(master, 'accounts:forgot_password') }}" class="breadcrumb-link">パスワードリセット</a>
          <span class="breadcrumb-separator">›</span>
        </li>
        <li class="breadcrumb-item">
          <span class="breadcrumb-current">確認コード入力</span>
        </li>
      </ol>
    </nav>

    <!-- Main Content Grid -->
    <div class="account-grid">
      <div class="account-main slide-up">
        <div class="account-section">
          <div class="section-header">
            <i data-lucide="key" class="section-icon"></i>
            <h2 class="section-title">新しいパスワードの設定</h2>
          </div>

          {% if message %}
          <div class="account-alert success">
            <i data-lucide="check-circle" class="alert-icon"></i>
            <div>{{ message }}</div>
          </div>
          {% endif %}

          {% if error %}
          <div class="account-alert error">
            <i data-lucide="alert-circle" class="alert-icon"></i>
            <div>{{ error }}</div>
          </div>
          {% endif %}

          <form method="post" class="account-form" id="resetPasswordForm">
            <div class="form-group">
              <label class="form-label">{{ form.username.label }}</label>
              {{ form.username(class="form-input" + (" error" if form.username.errors else ""), id="username", autocomplete="username", readonly=True) }}
              {% if form.username.errors %}
              <div class="form-error">
                <i data-lucide="alert-circle" style="width: 14px; height: 14px;"></i>
                {% for error in form.username.errors %}
                {{ error }}
                {% endfor %}
              </div>
              {% endif %}
            </div>

            <div class="form-group">
              <label class="form-label">{{ form.confirmation_code.label }}</label>
              {{ form.confirmation_code(class="form-input" + (" error" if form.confirmation_code.errors else ""), id="confirmationCode", autocomplete="one-time-code", placeholder="000000") }}
              {% if form.confirmation_code.errors %}
              <div class="form-error">
                <i data-lucide="alert-circle" style="width: 14px; height: 14px;"></i>
                {% for error in form.confirmation_code.errors %}
                {{ error }}
                {% endfor %}
              </div>
              {% endif %}
              <div class="form-help">
                メールで送信された6桁の数字を入力してください
              </div>
            </div>

            <div class="form-group">
              <label class="form-label">{{ form.new_password.label }}</label>
              {{ form.new_password(class="form-input" + (" error" if form.new_password.errors else ""), id="newPassword", autocomplete="new-password") }}
              {% if form.new_password.errors %}
              <div class="form-error">
                <i data-lucide="alert-circle" style="width: 14px; height: 14px;"></i>
                {% for error in form.new_password.errors %}
                {{ error }}
                {% endfor %}
              </div>
              {% endif %}
              <div class="form-help">
                8文字以上で、英数字と記号を組み合わせてください
              </div>

              <!-- Password Strength Indicator -->
              <div class="password-strength" id="passwordStrength" style="display: none;">
                <div class="strength-label">パスワードの強度:</div>
                <div class="strength-bar">
                  <div class="strength-fill" id="strengthFill"></div>
                </div>
                <div class="strength-text" id="strengthText"></div>
              </div>
            </div>

            <div class="form-group">
              <label class="form-label">{{ form.confirm_password.label }}</label>
              {{ form.confirm_password(class="form-input" + (" error" if form.confirm_password.errors else ""), id="confirmPassword", autocomplete="new-password") }}
              {% if form.confirm_password.errors %}
              <div class="form-error">
                <i data-lucide="alert-circle" style="width: 14px; height: 14px;"></i>
                {% for error in form.confirm_password.errors %}
                {{ error }}
                {% endfor %}
              </div>
              {% endif %}
              <div class="password-match" id="passwordMatch" style="display: none;"></div>
            </div>

            <div class="form-actions">
              <button type="submit" class="form-submit" id="submitBtn">
                <i data-lucide="key" class="btn-icon"></i>
                パスワードをリセット
              </button>
              <a href="{{ reverse(master, 'accounts:forgot_password') }}" class="action-btn secondary">
                <i data-lucide="arrow-left" class="btn-icon"></i>
                戻る
              </a>
            </div>
          </form>
        </div>
      </div>

      <!-- Sidebar -->
      <div class="account-sidebar slide-up">
        <h3 class="sidebar-title">確認コードについて</h3>
        <div class="help-content">
          <div style="margin-bottom: var(--space-lg);">
            <h4 style="font-size: 0.875rem; font-weight: var(--font-weight-semibold); margin-bottom: var(--space-sm); color: var(--text-primary);">確認コードの形式</h4>
            <ul class="help-list">
              <li>6桁の数字です</li>
              <li>メールのタイトルは「パスワードリセット確認コード」です</li>
              <li>有効期限は24時間です</li>
            </ul>
          </div>

          <div style="margin-bottom: var(--space-lg);">
            <h4 style="font-size: 0.875rem; font-weight: var(--font-weight-semibold); margin-bottom: var(--space-sm); color: var(--text-primary);">メールが届かない場合</h4>
            <ul class="help-list">
              <li>迷惑メールフォルダを確認してください</li>
              <li>数分お待ちください</li>
              <li>前のページに戻って再送信してください</li>
            </ul>
          </div>
        </div>

        <div class="help-box">
          <div class="help-title">
            <i data-lucide="shield" style="width: 14px; height: 14px;"></i>
            セキュリティのヒント
          </div>
          <div class="help-content">
            <ul class="help-list">
              <li>8文字以上で設定してください</li>
              <li>大文字と小文字を混在させましょう</li>
              <li>数字と記号を含めましょう</li>
              <li>他のサービスと同じパスワードは避けましょう</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock content %}

{% block extra_js %}
<script src="{{ static(master, 'js/accounts.js') }}"></script>
{% endblock extra_js %}