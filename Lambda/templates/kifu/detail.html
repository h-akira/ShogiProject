{% extends 'base.html' %}
{% block extra_css %}
<script defer src="https://cdn.jsdelivr.net/npm/shogi-player@1.1.24"></script>
<link rel="stylesheet" href="{{ static(master, 'css/shogi.css') }}">
<link rel="stylesheet" href="{{ static(master, 'css/detail.css') }}">
{% endblock extra_css %}

{% block title %}{{ slug }} - 棋譜詳細{% endblock title %}

{% block content %}
<div class="kifu-detail-page">
  <div class="container">
    {% if type == 'normal' %}
    <!-- Kifu Header -->
    <div class="kifu-header">
      <h1 class="kifu-title">{{ slug }}</h1>
      
      <div class="kifu-meta">
        <div class="meta-item">
          <span class="meta-label">
            <i data-lucide="calendar-plus" style="width: 16px; height: 16px;"></i>
            作成日時
          </span>
          <span class="meta-value">{{ created }}</span>
        </div>
        
        <div class="meta-item">
          <span class="meta-label">
            <i data-lucide="clock" style="width: 16px; height: 16px;"></i>
            最終更新
          </span>
          <span class="meta-value">{{ latest_update }}</span>
        </div>
        
        {% if kifu_tags and kifu_tags|length > 0 %}
        <div class="meta-item">
          <span class="meta-label">
            <i data-lucide="tag" style="width: 16px; height: 16px;"></i>
            タグ
          </span>
          <div class="kifu-tags">
            {% for tag in kifu_tags %}
            <a href="{{ reverse(master, 'tag:detail', username=username, tid=tag.tid) }}" class="tag">
              {{ tag.tname }}
            </a>
            {% endfor %}
          </div>
        </div>
        {% endif %}
      </div>
    </div>
    {% endif %}

    {% if memo %}
    <!-- Memo Section -->
    <div class="memo-section">
      <h2 class="memo-title">
        <i data-lucide="file-text" style="width: 20px; height: 20px;"></i>
        メモ
      </h2>
      <div class="memo-content">{{ memo }}</div>
    </div>
    {% endif %}

    {% if type == 'normal' %}
    <!-- Action Bar -->
    <div class="action-bar">
      <a href="{{ reverse(master, 'kifu:edit', username=username, kid=kid) }}" class="action-button">
        <i data-lucide="edit" style="width: 16px; height: 16px;"></i>
        編集
      </a>
      
      {% if not share %}
      <div style="display: none;">
      {% endif %}
      <a id="share-link" href="{{ reverse(master, 'kifu:share', share_code=share_code) }}" class="action-button primary">
        <i data-lucide="share-2" style="width: 16px; height: 16px;"></i>
        共有ページ
      </a>
      
      <button id="copy-button" class="action-button">
        <i data-lucide="copy" style="width: 16px; height: 16px;"></i>
        URLをコピー
      </button>
      {% if not share %}
      </div>
      {% endif %}
    </div>
    {% endif %}

    <!-- Shogi Board -->
    <div class="shogi-board-container">
      <div class="board-header">
        <h2 class="board-title">
          <i data-lucide="chess-king" style="width: 20px; height: 20px;"></i>
          棋譜再生
        </h2>
      </div>
      
      <shogi-player-wc
        id="sp"
        sp_body="{{ kifu }}"
        sp_turn="0"
        sp_controller="true"
        sp_slider="true"
        sp_mode="view"
        sp_coordinate="true"
        sp_overlay_nav="true"
      ></shogi-player-wc>
    </div>
  
      <!-- Board Controls -->
      <div class="board-controls-section">
        <div class="control-group">
          <button id="view-button" class="board-control-btn primary">
            <i data-lucide="eye" style="width: 16px; height: 16px;"></i>
            本筋
          </button>
          <button id="play-button" class="board-control-btn">
            <i data-lucide="play" style="width: 16px; height: 16px;"></i>
            継盤
          </button>
        </div>
        
        <button id="viewpoint-button" class="board-control-btn secondary">
          <i data-lucide="rotate-3d" style="width: 16px; height: 16px;"></i>
          盤面反転
        </button>
        
        {% if master.request.auth %}
        <div class="analysis-controls-vertical">
          <select id="analysis-time-select" class="analysis-time-select">
            <option value="3000">3秒</option>
            <option value="5000">5秒</option>
            <option value="10000">10秒</option>
          </select>
          <button id="analyze-button" class="analysis-button">
            <i data-lucide="zap" style="width: 16px; height: 16px;"></i>
            解析開始
          </button>
        </div>
        {% endif %}
      </div>
      
      <!-- Kifu Text Section -->
      <div class="kifu-text-section">
        <div class="kifu-text-header">
          <h3 class="kifu-text-title">
            <i data-lucide="file-text" style="width: 20px; height: 20px;"></i>
            棋譜データ
          </h3>
        </div>
        <div class="kifu-text-container">
          <pre class="kifu-text">{{ kifu }}</pre>
        </div>
      </div>
    </div>
  </div>\n</div>
{% endblock content %}

{% block extra_js %}
{% if master.request.auth %}
<script src="{{ static(master, 'js/analysis.js') }}"></script>
{% endif %}
{% if share %}
<script src="{{ static(master, 'js/clip.js') }}"></script>
{% endif %}
{% endblock extra_js %}
